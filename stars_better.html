 <html>
 <head>
     <style>
         rect {
             fill:black;
         }
         g {
             fill:white;
         }
     </style>
 </head>
 <body>
 <script src="https://d3js.org/d3.v4.min.js"></script>
 <script>
     var svg = d3.select("body")
                    .append("svg"),
             bufferSvg = 25,
             sizeSvg = {"w":(360*3 + bufferSvg),"h":(180*3 + bufferSvg)};

     svg.attr("width", sizeSvg.w )
             .attr("height", sizeSvg.h );

     svg.append("rect")
             .attr("x",bufferSvg)
             .attr("y",0)
             .attr("width",sizeSvg.w - bufferSvg)
             .attr("height",sizeSvg.h - bufferSvg);

     var csvfile = "csvs/stars-20571.csv";
     d3.csv( csvfile, function( d ) {
         return [d.ra*1, d.dec*1, d.phot_g_mean_flux *1];
     }, function( data ) {

         var total = data.length;
         console.log(total, data[0]);

         var extentFlux = d3.extent(data,function(d) { return d[2]; });

         //console.log(extentRa, extentDec, extentFlux);
         var xScale = d3.scaleLinear()
                 .range([bufferSvg,sizeSvg.w])
                 .domain([0,360]);

         var yScale = d3.scaleLinear()
                 .range([0,sizeSvg.h-bufferSvg])
                 .domain([90,-90]);

         var fluxScale = d3.scaleLinear()
                 .range([1,5])
                 .domain(extentFlux);

         var fluxColourScale = d3.scaleLog()
                 .range([10,256])
                 .domain(extentFlux);

		 var fluxDelayScale = d3.scaleLog()
				 .range([10000,100])
				 .domain(extentFlux);

         var xAxisBottom = d3.axisBottom(xScale);
         svg.append("g")
                 .attr("class", "xaxis bottom")
                 .attr("transform", "translate(0,"+ (sizeSvg.h-bufferSvg+1) + ")")
                 .call(xAxisBottom);


         var yAxisLeft= d3.axisLeft(yScale);
         svg.append("g")
                 .attr("class", "yaxis left")
                 .attr("transform", "translate(" +(bufferSvg-2) + ",0)")
                 .call(yAxisLeft);

         svg.append("g").selectAll("circle")
                 .data(data)
                 .enter()
                 .append("circle")
                 .attr("cx",function(d) { return xScale(d[0]); })
                 .attr("cy",function(d) { return yScale(d[1]); })
				 .attr("r",function(d) { return fluxScale(d[2]); })
				 .attr("fill","black")
				 .transition()
				 .delay(function(d) {
					 //return (d[0] + d[1])*10;
					 return fluxDelayScale(d[2]);
				 })
                 .attr("fill",function(d) {
                    var col = Math.ceil(fluxColourScale(d[2]))+"";
                    return "rgb(" + col + "," + col + "," + col + ")";
				 });

     })
 </script>
 </body>
 </html>
